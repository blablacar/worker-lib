#!/usr/bin/env php
<?php

require_once __DIR__.'/../../vendor/autoload.php';

$connection = new \AMQPConnection();
$connection->connect();
$channel = new \AMQPChannel($connection);

echo "create exchange\n";
$exchange = new AMQPExchange($channel);
$exchange->setType(AMQP_EX_TYPE_DIRECT);
$exchange->setName('blablacar_worker_exchange_test');
$exchange->declareExchange();

echo "create queue\n";
$queue = new \AMQPQueue($channel);
$queue->setName('blablacar_worker_queue_test');
$queue->setFlags(AMQP_DURABLE);
$queue->declareQueue();

echo "bind queue\n";
$queue->bind('blablacar_worker_exchange_test', 'test');

echo "Publish messages\n";
for ($i = 0; $i < 1000; $i++) {
    $exchange->publish("message$i", 'test');
}

echo "create queue\n";
$queue = new \AMQPQueue($channel);
$queue->setName('blablacar_delete_test');
$queue->setFlags(AMQP_DURABLE);
$queue->declareQueue();
